{"index":{"version":"0.5.12","fields":[{"name":"title","boost":10},{"name":"keywords","boost":15},{"name":"body","boost":1}],"ref":"url","documentStore":{"store":{"./":["introduct"],"todo/":["1.","airticl","cup","drink","tea","todo","todo1.","write"],"todo/doki.html":["1.","doki代办","doki代办1."],"learn/mysql/":["1.","mysql","mysql1."],"learn/mysql/lock.html":["\"1\"","#不加锁获取","#更新","*","1","1.","1;",":","=","begin;","citi","commit;","cur_stock;","cur_stock”，只有程序中获取到的库存量与数据库中的库存量相等才执行更新","good","id","id=1","innodb行锁是通过给索引上的索引项加锁来实现的，只有通过索引条件检索数据，innodb才使用行级锁，否则，innodb将使用表锁。==行锁一定有索引==","like，查到或查不到数据，主键字段产生表锁。","lock","mode;","mode==","mysql会对查询结果集中每行数据都添加排他锁，其他线程对该记录的更新与删除操作都会阻塞。","name='prod11'","select","set","share","stock","thank","updat","update;","update==","update仅适用于innodb，且必须在事务块(begin/commit)中才能生效","zhiboer","“stock","乐观锁","乐观锁适合读取频繁的场景。","值，这里需要注意","共享锁","共享锁指的就是对于多个不同的事务，对同一个资源共享同一个锁。","关键字：==for","关键字：==lock","前提","只根据主键进行查询，并且查询到数据，主键字段产生行锁。","只根据主键进行查询，查询条件为","只根据主键进行查询，查询条件为不等于，查到或查不到数据，主键字段产生都表锁。","在更新数据的时候需要比较程序中的库存量与数据库中的库存量是否相等，如果相等则进行更新，反之程序重新获取库存量，再次进行比较，直到两个库存量的数值相等才进行数据更新。","多个不同的事务，对同一个资源只能有一把锁。","如果mysql认为全表扫描效率更高，比如对一些很小的表，它就不会使用索引，这种情况下innodb将使用表锁，而不是行锁。","当表有多个索引的时候，不同的事务可以使用不同的索引锁定不同的行，另外，不论是使用主键索引、唯一索引或普通索引，innodb都会使用行锁来对数据加锁。","怎么锁?","怎么锁?1.","总结","悲观锁","悲观锁适合写入频繁的场景。begin;","排他锁","排他锁包含行锁、表锁。","数据一致性","期间其他用户阻塞等待访问该记录。","条件","根据主键、非主键不含索引（name）进行查询，并且查询到数据，如果其他线程按主键字段进行再次查询，则主键字段产生行锁，如果其他线程按非主键不含索引字段进行查询，则非主键不含索引字段产生表锁，如果其他线程按非主键含索引字段进行查询，则非主键含索引字段产生行锁，如果索引值是枚举类型，mysql也会进行表锁。","根据主键、非主键含索引（name）进行查询，并且查询到数据，主键字段产生行锁，name字段产生行锁。begin;","根据非主键不含索引（name）进行查询，查到或查不到数据，name字段产生表锁。","根据非主键含索引（name）进行查询，并且查询到数据，name字段产生行锁。","检索值的==数据类型==与索引字段不同，虽然mysql能够进行数据类型转换，但却不会使用索引，从而导致innodb使用表锁。","每次获取商品时，不对该商品加锁。","每次获取商品时，对该商品加排他锁。","没有线程对该结果集中的任何行数据使用排他锁或共享锁，否则申请会阻塞。","的商品对象","行锁和表锁","除了使用非主键不含索引字段查询，其余所有的查询，没有查询到数据，就不产生锁。","静下心来静下心来"],"learn/redis/":["1.","redi","redis1."],"learn/linux/":["1.","linux","linux1."],"learn/python/":["1.","python","python1."],"learn/python/django.html":["1.","django","django1."]},"length":9},"tokenStore":{"root":{"1":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.05309734513274336}},".":{"docs":{"todo/":{"ref":"todo/","tf":0.125},"todo/doki.html":{"ref":"todo/doki.html","tf":0.3333333333333333},"learn/mysql/":{"ref":"learn/mysql/","tf":0.3333333333333333},"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894},"learn/redis/":{"ref":"learn/redis/","tf":0.3333333333333333},"learn/linux/":{"ref":"learn/linux/","tf":0.3333333333333333},"learn/python/":{"ref":"learn/python/","tf":0.3333333333333333},"learn/python/django.html":{"ref":"learn/python/django.html","tf":0.3333333333333333}}},";":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}},"docs":{},"i":{"docs":{},"n":{"docs":{},"t":{"docs":{},"r":{"docs":{},"o":{"docs":{},"d":{"docs":{},"u":{"docs":{},"c":{"docs":{},"t":{"docs":{"./":{"ref":"./","tf":10}}}}}}}}},"n":{"docs":{},"o":{"docs":{},"d":{"docs":{},"b":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"是":{"docs":{},"通":{"docs":{},"过":{"docs":{},"给":{"docs":{},"索":{"docs":{},"引":{"docs":{},"上":{"docs":{},"的":{"docs":{},"索":{"docs":{},"引":{"docs":{},"项":{"docs":{},"加":{"docs":{},"锁":{"docs":{},"来":{"docs":{},"实":{"docs":{},"现":{"docs":{},"的":{"docs":{},"，":{"docs":{},"只":{"docs":{},"有":{"docs":{},"通":{"docs":{},"过":{"docs":{},"索":{"docs":{},"引":{"docs":{},"条":{"docs":{},"件":{"docs":{},"检":{"docs":{},"索":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"i":{"docs":{},"n":{"docs":{},"n":{"docs":{},"o":{"docs":{},"d":{"docs":{},"b":{"docs":{},"才":{"docs":{},"使":{"docs":{},"用":{"docs":{},"行":{"docs":{},"级":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"否":{"docs":{},"则":{"docs":{},"，":{"docs":{},"i":{"docs":{},"n":{"docs":{},"n":{"docs":{},"o":{"docs":{},"d":{"docs":{},"b":{"docs":{},"将":{"docs":{},"使":{"docs":{},"用":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"。":{"docs":{},"=":{"docs":{},"=":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"一":{"docs":{},"定":{"docs":{},"有":{"docs":{},"索":{"docs":{},"引":{"docs":{},"=":{"docs":{},"=":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"d":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.05309734513274336}},"=":{"1":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}},"docs":{}}}},"a":{"docs":{},"i":{"docs":{},"r":{"docs":{},"t":{"docs":{},"i":{"docs":{},"c":{"docs":{},"l":{"docs":{"todo/":{"ref":"todo/","tf":0.125}}}}}}}}},"c":{"docs":{},"u":{"docs":{},"p":{"docs":{"todo/":{"ref":"todo/","tf":0.125}}},"r":{"docs":{},"_":{"docs":{},"s":{"docs":{},"t":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{},";":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}},"”":{"docs":{},"，":{"docs":{},"只":{"docs":{},"有":{"docs":{},"程":{"docs":{},"序":{"docs":{},"中":{"docs":{},"获":{"docs":{},"取":{"docs":{},"到":{"docs":{},"的":{"docs":{},"库":{"docs":{},"存":{"docs":{},"量":{"docs":{},"与":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"中":{"docs":{},"的":{"docs":{},"库":{"docs":{},"存":{"docs":{},"量":{"docs":{},"相":{"docs":{},"等":{"docs":{},"才":{"docs":{},"执":{"docs":{},"行":{"docs":{},"更":{"docs":{},"新":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"i":{"docs":{},"t":{"docs":{},"i":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}},"o":{"docs":{},"m":{"docs":{},"m":{"docs":{},"i":{"docs":{},"t":{"docs":{},";":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.02654867256637168}}}}}}}}},"d":{"docs":{},"r":{"docs":{},"i":{"docs":{},"n":{"docs":{},"k":{"docs":{"todo/":{"ref":"todo/","tf":0.125}}}}}},"o":{"docs":{},"k":{"docs":{},"i":{"docs":{},"代":{"docs":{},"办":{"1":{"docs":{},".":{"docs":{"todo/doki.html":{"ref":"todo/doki.html","tf":0.3333333333333333}}}},"docs":{"todo/doki.html":{"ref":"todo/doki.html","tf":10.333333333333334}}}}}}},"j":{"docs":{},"a":{"docs":{},"n":{"docs":{},"g":{"docs":{},"o":{"1":{"docs":{},".":{"docs":{"learn/python/django.html":{"ref":"learn/python/django.html","tf":0.3333333333333333}}}},"docs":{"learn/python/django.html":{"ref":"learn/python/django.html","tf":10.333333333333334}}}}}}}},"t":{"docs":{},"e":{"docs":{},"a":{"docs":{"todo/":{"ref":"todo/","tf":0.125}}}},"o":{"docs":{},"d":{"docs":{},"o":{"1":{"docs":{},".":{"docs":{"todo/":{"ref":"todo/","tf":0.125}}}},"docs":{"todo/":{"ref":"todo/","tf":10.125}}}}},"h":{"docs":{},"a":{"docs":{},"n":{"docs":{},"k":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}},"w":{"docs":{},"r":{"docs":{},"i":{"docs":{},"t":{"docs":{},"e":{"docs":{"todo/":{"ref":"todo/","tf":0.125}}}}}}},"m":{"docs":{},"y":{"docs":{},"s":{"docs":{},"q":{"docs":{},"l":{"1":{"docs":{},".":{"docs":{"learn/mysql/":{"ref":"learn/mysql/","tf":0.3333333333333333}}}},"docs":{"learn/mysql/":{"ref":"learn/mysql/","tf":10.333333333333334}},"会":{"docs":{},"对":{"docs":{},"查":{"docs":{},"询":{"docs":{},"结":{"docs":{},"果":{"docs":{},"集":{"docs":{},"中":{"docs":{},"每":{"docs":{},"行":{"docs":{},"数":{"docs":{},"据":{"docs":{},"都":{"docs":{},"添":{"docs":{},"加":{"docs":{},"排":{"docs":{},"他":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"其":{"docs":{},"他":{"docs":{},"线":{"docs":{},"程":{"docs":{},"对":{"docs":{},"该":{"docs":{},"记":{"docs":{},"录":{"docs":{},"的":{"docs":{},"更":{"docs":{},"新":{"docs":{},"与":{"docs":{},"删":{"docs":{},"除":{"docs":{},"操":{"docs":{},"作":{"docs":{},"都":{"docs":{},"会":{"docs":{},"阻":{"docs":{},"塞":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"o":{"docs":{},"d":{"docs":{},"e":{"docs":{},";":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}},"=":{"docs":{},"=":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}},"\"":{"1":{"docs":{},"\"":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}},"docs":{}},"#":{"docs":{},"不":{"docs":{},"加":{"docs":{},"锁":{"docs":{},"获":{"docs":{},"取":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}},"更":{"docs":{},"新":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}},"*":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.035398230088495575}}},":":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}},"=":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.08849557522123894}}},"b":{"docs":{},"e":{"docs":{},"g":{"docs":{},"i":{"docs":{},"n":{"docs":{},";":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.017699115044247787}}}}}}}},"g":{"docs":{},"o":{"docs":{},"o":{"docs":{},"d":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.04424778761061947}}}}}},"l":{"docs":{},"i":{"docs":{},"k":{"docs":{},"e":{"docs":{},"，":{"docs":{},"查":{"docs":{},"到":{"docs":{},"或":{"docs":{},"查":{"docs":{},"不":{"docs":{},"到":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"主":{"docs":{},"键":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}},"n":{"docs":{},"u":{"docs":{},"x":{"1":{"docs":{},".":{"docs":{"learn/linux/":{"ref":"learn/linux/","tf":0.3333333333333333}}}},"docs":{"learn/linux/":{"ref":"learn/linux/","tf":10.333333333333334}}}}}},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"=":{"docs":{},"'":{"docs":{},"p":{"docs":{},"r":{"docs":{},"o":{"docs":{},"d":{"1":{"1":{"docs":{},"'":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}},"docs":{}},"docs":{}}}}}}}}}}},"s":{"docs":{},"e":{"docs":{},"l":{"docs":{},"e":{"docs":{},"c":{"docs":{},"t":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.035398230088495575}}}}}},"t":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.017699115044247787}}}},"h":{"docs":{},"a":{"docs":{},"r":{"docs":{},"e":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.017699115044247787}}}}}},"t":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.05309734513274336}}}}}}},"u":{"docs":{},"p":{"docs":{},"d":{"docs":{},"a":{"docs":{},"t":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.017699115044247787}},"e":{"docs":{},";":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.017699115044247787}}},"=":{"docs":{},"=":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}},"仅":{"docs":{},"适":{"docs":{},"用":{"docs":{},"于":{"docs":{},"i":{"docs":{},"n":{"docs":{},"n":{"docs":{},"o":{"docs":{},"d":{"docs":{},"b":{"docs":{},"，":{"docs":{},"且":{"docs":{},"必":{"docs":{},"须":{"docs":{},"在":{"docs":{},"事":{"docs":{},"务":{"docs":{},"块":{"docs":{},"(":{"docs":{},"b":{"docs":{},"e":{"docs":{},"g":{"docs":{},"i":{"docs":{},"n":{"docs":{},"/":{"docs":{},"c":{"docs":{},"o":{"docs":{},"m":{"docs":{},"m":{"docs":{},"i":{"docs":{},"t":{"docs":{},")":{"docs":{},"中":{"docs":{},"才":{"docs":{},"能":{"docs":{},"生":{"docs":{},"效":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"z":{"docs":{},"h":{"docs":{},"i":{"docs":{},"b":{"docs":{},"o":{"docs":{},"e":{"docs":{},"r":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}},"“":{"docs":{},"s":{"docs":{},"t":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}},"乐":{"docs":{},"观":{"docs":{},"锁":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}},"适":{"docs":{},"合":{"docs":{},"读":{"docs":{},"取":{"docs":{},"频":{"docs":{},"繁":{"docs":{},"的":{"docs":{},"场":{"docs":{},"景":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}},"值":{"docs":{},"，":{"docs":{},"这":{"docs":{},"里":{"docs":{},"需":{"docs":{},"要":{"docs":{},"注":{"docs":{},"意":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}},"共":{"docs":{},"享":{"docs":{},"锁":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}},"指":{"docs":{},"的":{"docs":{},"就":{"docs":{},"是":{"docs":{},"对":{"docs":{},"于":{"docs":{},"多":{"docs":{},"个":{"docs":{},"不":{"docs":{},"同":{"docs":{},"的":{"docs":{},"事":{"docs":{},"务":{"docs":{},"，":{"docs":{},"对":{"docs":{},"同":{"docs":{},"一":{"docs":{},"个":{"docs":{},"资":{"docs":{},"源":{"docs":{},"共":{"docs":{},"享":{"docs":{},"同":{"docs":{},"一":{"docs":{},"个":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"关":{"docs":{},"键":{"docs":{},"字":{"docs":{},"：":{"docs":{},"=":{"docs":{},"=":{"docs":{},"f":{"docs":{},"o":{"docs":{},"r":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}},"l":{"docs":{},"o":{"docs":{},"c":{"docs":{},"k":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}},"前":{"docs":{},"提":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}},"只":{"docs":{},"根":{"docs":{},"据":{"docs":{},"主":{"docs":{},"键":{"docs":{},"进":{"docs":{},"行":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"并":{"docs":{},"且":{"docs":{},"查":{"docs":{},"询":{"docs":{},"到":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"主":{"docs":{},"键":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}},"查":{"docs":{},"询":{"docs":{},"条":{"docs":{},"件":{"docs":{},"为":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}},"不":{"docs":{},"等":{"docs":{},"于":{"docs":{},"，":{"docs":{},"查":{"docs":{},"到":{"docs":{},"或":{"docs":{},"查":{"docs":{},"不":{"docs":{},"到":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"主":{"docs":{},"键":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"都":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"在":{"docs":{},"更":{"docs":{},"新":{"docs":{},"数":{"docs":{},"据":{"docs":{},"的":{"docs":{},"时":{"docs":{},"候":{"docs":{},"需":{"docs":{},"要":{"docs":{},"比":{"docs":{},"较":{"docs":{},"程":{"docs":{},"序":{"docs":{},"中":{"docs":{},"的":{"docs":{},"库":{"docs":{},"存":{"docs":{},"量":{"docs":{},"与":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"中":{"docs":{},"的":{"docs":{},"库":{"docs":{},"存":{"docs":{},"量":{"docs":{},"是":{"docs":{},"否":{"docs":{},"相":{"docs":{},"等":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"相":{"docs":{},"等":{"docs":{},"则":{"docs":{},"进":{"docs":{},"行":{"docs":{},"更":{"docs":{},"新":{"docs":{},"，":{"docs":{},"反":{"docs":{},"之":{"docs":{},"程":{"docs":{},"序":{"docs":{},"重":{"docs":{},"新":{"docs":{},"获":{"docs":{},"取":{"docs":{},"库":{"docs":{},"存":{"docs":{},"量":{"docs":{},"，":{"docs":{},"再":{"docs":{},"次":{"docs":{},"进":{"docs":{},"行":{"docs":{},"比":{"docs":{},"较":{"docs":{},"，":{"docs":{},"直":{"docs":{},"到":{"docs":{},"两":{"docs":{},"个":{"docs":{},"库":{"docs":{},"存":{"docs":{},"量":{"docs":{},"的":{"docs":{},"数":{"docs":{},"值":{"docs":{},"相":{"docs":{},"等":{"docs":{},"才":{"docs":{},"进":{"docs":{},"行":{"docs":{},"数":{"docs":{},"据":{"docs":{},"更":{"docs":{},"新":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"多":{"docs":{},"个":{"docs":{},"不":{"docs":{},"同":{"docs":{},"的":{"docs":{},"事":{"docs":{},"务":{"docs":{},"，":{"docs":{},"对":{"docs":{},"同":{"docs":{},"一":{"docs":{},"个":{"docs":{},"资":{"docs":{},"源":{"docs":{},"只":{"docs":{},"能":{"docs":{},"有":{"docs":{},"一":{"docs":{},"把":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}},"如":{"docs":{},"果":{"docs":{},"m":{"docs":{},"y":{"docs":{},"s":{"docs":{},"q":{"docs":{},"l":{"docs":{},"认":{"docs":{},"为":{"docs":{},"全":{"docs":{},"表":{"docs":{},"扫":{"docs":{},"描":{"docs":{},"效":{"docs":{},"率":{"docs":{},"更":{"docs":{},"高":{"docs":{},"，":{"docs":{},"比":{"docs":{},"如":{"docs":{},"对":{"docs":{},"一":{"docs":{},"些":{"docs":{},"很":{"docs":{},"小":{"docs":{},"的":{"docs":{},"表":{"docs":{},"，":{"docs":{},"它":{"docs":{},"就":{"docs":{},"不":{"docs":{},"会":{"docs":{},"使":{"docs":{},"用":{"docs":{},"索":{"docs":{},"引":{"docs":{},"，":{"docs":{},"这":{"docs":{},"种":{"docs":{},"情":{"docs":{},"况":{"docs":{},"下":{"docs":{},"i":{"docs":{},"n":{"docs":{},"n":{"docs":{},"o":{"docs":{},"d":{"docs":{},"b":{"docs":{},"将":{"docs":{},"使":{"docs":{},"用":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"而":{"docs":{},"不":{"docs":{},"是":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"当":{"docs":{},"表":{"docs":{},"有":{"docs":{},"多":{"docs":{},"个":{"docs":{},"索":{"docs":{},"引":{"docs":{},"的":{"docs":{},"时":{"docs":{},"候":{"docs":{},"，":{"docs":{},"不":{"docs":{},"同":{"docs":{},"的":{"docs":{},"事":{"docs":{},"务":{"docs":{},"可":{"docs":{},"以":{"docs":{},"使":{"docs":{},"用":{"docs":{},"不":{"docs":{},"同":{"docs":{},"的":{"docs":{},"索":{"docs":{},"引":{"docs":{},"锁":{"docs":{},"定":{"docs":{},"不":{"docs":{},"同":{"docs":{},"的":{"docs":{},"行":{"docs":{},"，":{"docs":{},"另":{"docs":{},"外":{"docs":{},"，":{"docs":{},"不":{"docs":{},"论":{"docs":{},"是":{"docs":{},"使":{"docs":{},"用":{"docs":{},"主":{"docs":{},"键":{"docs":{},"索":{"docs":{},"引":{"docs":{},"、":{"docs":{},"唯":{"docs":{},"一":{"docs":{},"索":{"docs":{},"引":{"docs":{},"或":{"docs":{},"普":{"docs":{},"通":{"docs":{},"索":{"docs":{},"引":{"docs":{},"，":{"docs":{},"i":{"docs":{},"n":{"docs":{},"n":{"docs":{},"o":{"docs":{},"d":{"docs":{},"b":{"docs":{},"都":{"docs":{},"会":{"docs":{},"使":{"docs":{},"用":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"来":{"docs":{},"对":{"docs":{},"数":{"docs":{},"据":{"docs":{},"加":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"怎":{"docs":{},"么":{"docs":{},"锁":{"docs":{},"?":{"1":{"docs":{},".":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}},"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":10.008849557522124}}}}}},"总":{"docs":{},"结":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}},"悲":{"docs":{},"观":{"docs":{},"锁":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}},"适":{"docs":{},"合":{"docs":{},"写":{"docs":{},"入":{"docs":{},"频":{"docs":{},"繁":{"docs":{},"的":{"docs":{},"场":{"docs":{},"景":{"docs":{},"。":{"docs":{},"b":{"docs":{},"e":{"docs":{},"g":{"docs":{},"i":{"docs":{},"n":{"docs":{},";":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}},"排":{"docs":{},"他":{"docs":{},"锁":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}},"包":{"docs":{},"含":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"、":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}},"数":{"docs":{},"据":{"docs":{},"一":{"docs":{},"致":{"docs":{},"性":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}},"期":{"docs":{},"间":{"docs":{},"其":{"docs":{},"他":{"docs":{},"用":{"docs":{},"户":{"docs":{},"阻":{"docs":{},"塞":{"docs":{},"等":{"docs":{},"待":{"docs":{},"访":{"docs":{},"问":{"docs":{},"该":{"docs":{},"记":{"docs":{},"录":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}},"条":{"docs":{},"件":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}},"根":{"docs":{},"据":{"docs":{},"主":{"docs":{},"键":{"docs":{},"、":{"docs":{},"非":{"docs":{},"主":{"docs":{},"键":{"docs":{},"不":{"docs":{},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"（":{"docs":{},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"）":{"docs":{},"进":{"docs":{},"行":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"并":{"docs":{},"且":{"docs":{},"查":{"docs":{},"询":{"docs":{},"到":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"其":{"docs":{},"他":{"docs":{},"线":{"docs":{},"程":{"docs":{},"按":{"docs":{},"主":{"docs":{},"键":{"docs":{},"字":{"docs":{},"段":{"docs":{},"进":{"docs":{},"行":{"docs":{},"再":{"docs":{},"次":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"则":{"docs":{},"主":{"docs":{},"键":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"其":{"docs":{},"他":{"docs":{},"线":{"docs":{},"程":{"docs":{},"按":{"docs":{},"非":{"docs":{},"主":{"docs":{},"键":{"docs":{},"不":{"docs":{},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"字":{"docs":{},"段":{"docs":{},"进":{"docs":{},"行":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"则":{"docs":{},"非":{"docs":{},"主":{"docs":{},"键":{"docs":{},"不":{"docs":{},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"其":{"docs":{},"他":{"docs":{},"线":{"docs":{},"程":{"docs":{},"按":{"docs":{},"非":{"docs":{},"主":{"docs":{},"键":{"docs":{},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"字":{"docs":{},"段":{"docs":{},"进":{"docs":{},"行":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"则":{"docs":{},"非":{"docs":{},"主":{"docs":{},"键":{"docs":{},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"索":{"docs":{},"引":{"docs":{},"值":{"docs":{},"是":{"docs":{},"枚":{"docs":{},"举":{"docs":{},"类":{"docs":{},"型":{"docs":{},"，":{"docs":{},"m":{"docs":{},"y":{"docs":{},"s":{"docs":{},"q":{"docs":{},"l":{"docs":{},"也":{"docs":{},"会":{"docs":{},"进":{"docs":{},"行":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"（":{"docs":{},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"）":{"docs":{},"进":{"docs":{},"行":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"并":{"docs":{},"且":{"docs":{},"查":{"docs":{},"询":{"docs":{},"到":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"主":{"docs":{},"键":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"。":{"docs":{},"b":{"docs":{},"e":{"docs":{},"g":{"docs":{},"i":{"docs":{},"n":{"docs":{},";":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"非":{"docs":{},"主":{"docs":{},"键":{"docs":{},"不":{"docs":{},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"（":{"docs":{},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"）":{"docs":{},"进":{"docs":{},"行":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"查":{"docs":{},"到":{"docs":{},"或":{"docs":{},"查":{"docs":{},"不":{"docs":{},"到":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"（":{"docs":{},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"）":{"docs":{},"进":{"docs":{},"行":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"并":{"docs":{},"且":{"docs":{},"查":{"docs":{},"询":{"docs":{},"到":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"n":{"docs":{},"a":{"docs":{},"m":{"docs":{},"e":{"docs":{},"字":{"docs":{},"段":{"docs":{},"产":{"docs":{},"生":{"docs":{},"行":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"检":{"docs":{},"索":{"docs":{},"值":{"docs":{},"的":{"docs":{},"=":{"docs":{},"=":{"docs":{},"数":{"docs":{},"据":{"docs":{},"类":{"docs":{},"型":{"docs":{},"=":{"docs":{},"=":{"docs":{},"与":{"docs":{},"索":{"docs":{},"引":{"docs":{},"字":{"docs":{},"段":{"docs":{},"不":{"docs":{},"同":{"docs":{},"，":{"docs":{},"虽":{"docs":{},"然":{"docs":{},"m":{"docs":{},"y":{"docs":{},"s":{"docs":{},"q":{"docs":{},"l":{"docs":{},"能":{"docs":{},"够":{"docs":{},"进":{"docs":{},"行":{"docs":{},"数":{"docs":{},"据":{"docs":{},"类":{"docs":{},"型":{"docs":{},"转":{"docs":{},"换":{"docs":{},"，":{"docs":{},"但":{"docs":{},"却":{"docs":{},"不":{"docs":{},"会":{"docs":{},"使":{"docs":{},"用":{"docs":{},"索":{"docs":{},"引":{"docs":{},"，":{"docs":{},"从":{"docs":{},"而":{"docs":{},"导":{"docs":{},"致":{"docs":{},"i":{"docs":{},"n":{"docs":{},"n":{"docs":{},"o":{"docs":{},"d":{"docs":{},"b":{"docs":{},"使":{"docs":{},"用":{"docs":{},"表":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"每":{"docs":{},"次":{"docs":{},"获":{"docs":{},"取":{"docs":{},"商":{"docs":{},"品":{"docs":{},"时":{"docs":{},"，":{"docs":{},"不":{"docs":{},"对":{"docs":{},"该":{"docs":{},"商":{"docs":{},"品":{"docs":{},"加":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}},"对":{"docs":{},"该":{"docs":{},"商":{"docs":{},"品":{"docs":{},"加":{"docs":{},"排":{"docs":{},"他":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}},"没":{"docs":{},"有":{"docs":{},"线":{"docs":{},"程":{"docs":{},"对":{"docs":{},"该":{"docs":{},"结":{"docs":{},"果":{"docs":{},"集":{"docs":{},"中":{"docs":{},"的":{"docs":{},"任":{"docs":{},"何":{"docs":{},"行":{"docs":{},"数":{"docs":{},"据":{"docs":{},"使":{"docs":{},"用":{"docs":{},"排":{"docs":{},"他":{"docs":{},"锁":{"docs":{},"或":{"docs":{},"共":{"docs":{},"享":{"docs":{},"锁":{"docs":{},"，":{"docs":{},"否":{"docs":{},"则":{"docs":{},"申":{"docs":{},"请":{"docs":{},"会":{"docs":{},"阻":{"docs":{},"塞":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"的":{"docs":{},"商":{"docs":{},"品":{"docs":{},"对":{"docs":{},"象":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}},"行":{"docs":{},"锁":{"docs":{},"和":{"docs":{},"表":{"docs":{},"锁":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}},"除":{"docs":{},"了":{"docs":{},"使":{"docs":{},"用":{"docs":{},"非":{"docs":{},"主":{"docs":{},"键":{"docs":{},"不":{"docs":{},"含":{"docs":{},"索":{"docs":{},"引":{"docs":{},"字":{"docs":{},"段":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"其":{"docs":{},"余":{"docs":{},"所":{"docs":{},"有":{"docs":{},"的":{"docs":{},"查":{"docs":{},"询":{"docs":{},"，":{"docs":{},"没":{"docs":{},"有":{"docs":{},"查":{"docs":{},"询":{"docs":{},"到":{"docs":{},"数":{"docs":{},"据":{"docs":{},"，":{"docs":{},"就":{"docs":{},"不":{"docs":{},"产":{"docs":{},"生":{"docs":{},"锁":{"docs":{},"。":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"静":{"docs":{},"下":{"docs":{},"心":{"docs":{},"来":{"docs":{},"静":{"docs":{},"下":{"docs":{},"心":{"docs":{},"来":{"docs":{"learn/mysql/lock.html":{"ref":"learn/mysql/lock.html","tf":0.008849557522123894}}}}}}}}}},"r":{"docs":{},"e":{"docs":{},"d":{"docs":{},"i":{"docs":{"learn/redis/":{"ref":"learn/redis/","tf":10.333333333333334}},"s":{"1":{"docs":{},".":{"docs":{"learn/redis/":{"ref":"learn/redis/","tf":0.3333333333333333}}}},"docs":{}}}}}},"p":{"docs":{},"y":{"docs":{},"t":{"docs":{},"h":{"docs":{},"o":{"docs":{},"n":{"1":{"docs":{},".":{"docs":{"learn/python/":{"ref":"learn/python/","tf":0.3333333333333333}}}},"docs":{"learn/python/":{"ref":"learn/python/","tf":10.333333333333334}}}}}}}}},"length":297},"corpusTokens":["\"1\"","#不加锁获取","#更新","*","1","1.","1;",":","=","airticl","begin;","citi","commit;","cup","cur_stock;","cur_stock”，只有程序中获取到的库存量与数据库中的库存量相等才执行更新","django","django1.","doki代办","doki代办1.","drink","good","id","id=1","innodb行锁是通过给索引上的索引项加锁来实现的，只有通过索引条件检索数据，innodb才使用行级锁，否则，innodb将使用表锁。==行锁一定有索引==","introduct","like，查到或查不到数据，主键字段产生表锁。","linux","linux1.","lock","mode;","mode==","mysql","mysql1.","mysql会对查询结果集中每行数据都添加排他锁，其他线程对该记录的更新与删除操作都会阻塞。","name='prod11'","python","python1.","redi","redis1.","select","set","share","stock","tea","thank","todo","todo1.","updat","update;","update==","update仅适用于innodb，且必须在事务块(begin/commit)中才能生效","write","zhiboer","“stock","乐观锁","乐观锁适合读取频繁的场景。","值，这里需要注意","共享锁","共享锁指的就是对于多个不同的事务，对同一个资源共享同一个锁。","关键字：==for","关键字：==lock","前提","只根据主键进行查询，并且查询到数据，主键字段产生行锁。","只根据主键进行查询，查询条件为","只根据主键进行查询，查询条件为不等于，查到或查不到数据，主键字段产生都表锁。","在更新数据的时候需要比较程序中的库存量与数据库中的库存量是否相等，如果相等则进行更新，反之程序重新获取库存量，再次进行比较，直到两个库存量的数值相等才进行数据更新。","多个不同的事务，对同一个资源只能有一把锁。","如果mysql认为全表扫描效率更高，比如对一些很小的表，它就不会使用索引，这种情况下innodb将使用表锁，而不是行锁。","当表有多个索引的时候，不同的事务可以使用不同的索引锁定不同的行，另外，不论是使用主键索引、唯一索引或普通索引，innodb都会使用行锁来对数据加锁。","怎么锁?","怎么锁?1.","总结","悲观锁","悲观锁适合写入频繁的场景。begin;","排他锁","排他锁包含行锁、表锁。","数据一致性","期间其他用户阻塞等待访问该记录。","条件","根据主键、非主键不含索引（name）进行查询，并且查询到数据，如果其他线程按主键字段进行再次查询，则主键字段产生行锁，如果其他线程按非主键不含索引字段进行查询，则非主键不含索引字段产生表锁，如果其他线程按非主键含索引字段进行查询，则非主键含索引字段产生行锁，如果索引值是枚举类型，mysql也会进行表锁。","根据主键、非主键含索引（name）进行查询，并且查询到数据，主键字段产生行锁，name字段产生行锁。begin;","根据非主键不含索引（name）进行查询，查到或查不到数据，name字段产生表锁。","根据非主键含索引（name）进行查询，并且查询到数据，name字段产生行锁。","检索值的==数据类型==与索引字段不同，虽然mysql能够进行数据类型转换，但却不会使用索引，从而导致innodb使用表锁。","每次获取商品时，不对该商品加锁。","每次获取商品时，对该商品加排他锁。","没有线程对该结果集中的任何行数据使用排他锁或共享锁，否则申请会阻塞。","的商品对象","行锁和表锁","除了使用非主键不含索引字段查询，其余所有的查询，没有查询到数据，就不产生锁。","静下心来静下心来"],"pipeline":["stopWordFilter","stemmer"]},"store":{"./":{"url":"./","title":"Introduction","keywords":"","body":""},"todo/":{"url":"todo/","title":"TODO","keywords":"","body":"1. TODO1. TODO\n\n write some airticles\n drink a cup of tea\n\n"},"todo/doki.html":{"url":"todo/doki.html","title":"Doki代办","keywords":"","body":"1. Doki代办1. Doki代办\n"},"learn/mysql/":{"url":"learn/mysql/","title":"MySQL","keywords":"","body":"1. MySQL1. MySQL\n"},"learn/mysql/lock.html":{"url":"learn/mysql/lock.html","title":"怎么锁?","keywords":"","body":"1. 怎么锁?1. 怎么锁?\n\nthanks :\n\nzhiboer\n静下心来静下心来\n\n前提\n\n\n没有线程对该结果集中的任何行数据使用排他锁或共享锁，否则申请会阻塞。\nfor update仅适用于InnoDB，且必须在事务块(BEGIN/COMMIT)中才能生效\nMySQL会对查询结果集中每行数据都添加排他锁，其他线程对该记录的更新与删除操作都会阻塞。\n排他锁包含行锁、表锁。\n\n\n\n数据一致性\n\n悲观锁\n\n\n共享锁\n共享锁指的就是对于多个不同的事务，对同一个资源共享同一个锁。\n关键字：==lock in share mode==\nbegin;\n SELECT * from city where id = \"1\"  lock in share mode;\n\n\n排他锁\n多个不同的事务，对同一个资源只能有一把锁。\n关键字：==for update==\n\n每次获取商品时，对该商品加排他锁。\n期间其他用户阻塞等待访问该记录。\n悲观锁适合写入频繁的场景。begin;\nselect * from goods where id = 1 for update;\nupdate goods set stock = stock - 1 where id = 1;\ncommit;\n\n\n\n\n\n\n\n乐观锁\n\n\n每次获取商品时，不对该商品加锁。\n在更新数据的时候需要比较程序中的库存量与数据库中的库存量是否相等，如果相等则进行更新，反之程序重新获取库存量，再次进行比较，直到两个库存量的数值相等才进行数据更新。\n乐观锁适合读取频繁的场景。\n\n\n\n\n\n#不加锁获取 id=1 的商品对象\nselect * from goods where id = 1\n\nbegin;\n    #更新 stock 值，这里需要注意 where 条件 “stock = cur_stock”，只有程序中获取到的库存量与数据库中的库存量相等才执行更新\n    update goods set stock = stock - 1 where id = 1 and stock = cur_stock;\ncommit;\n\n行锁和表锁\n\n\n只根据主键进行查询，并且查询到数据，主键字段产生行锁。\n除了使用非主键不含索引字段查询，其余所有的查询，没有查询到数据，就不产生锁。\n根据主键、非主键含索引（name）进行查询，并且查询到数据，主键字段产生行锁，name字段产生行锁。begin;\nselect * from goods where id = 1 and name='prod11' for update;\ncommit;\n\n根据主键、非主键不含索引（name）进行查询，并且查询到数据，如果其他线程按主键字段进行再次查询，则主键字段产生行锁，如果其他线程按非主键不含索引字段进行查询，则非主键不含索引字段产生表锁，如果其他线程按非主键含索引字段进行查询，则非主键含索引字段产生行锁，如果索引值是枚举类型，mysql也会进行表锁。\n根据非主键含索引（name）进行查询，并且查询到数据，name字段产生行锁。\n根据非主键不含索引（name）进行查询，查到或查不到数据，name字段产生表锁。\n只根据主键进行查询，查询条件为不等于，查到或查不到数据，主键字段产生都表锁。\n只根据主键进行查询，查询条件为 like，查到或查不到数据，主键字段产生表锁。\n\n\n\n总结\n\n\nInnoDB行锁是通过给索引上的索引项加锁来实现的，只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁。==行锁一定有索引==\n当表有多个索引的时候，不同的事务可以使用不同的索引锁定不同的行，另外，不论是使用主键索引、唯一索引或普通索引，InnoDB都会使用行锁来对数据加锁。 \n如果MySQL认为全表扫描效率更高，比如对一些很小的表，它就不会使用索引，这种情况下InnoDB将使用表锁，而不是行锁。\n检索值的==数据类型==与索引字段不同，虽然MySQL能够进行数据类型转换，但却不会使用索引，从而导致InnoDB使用表锁。\n\n\n\n\n"},"learn/redis/":{"url":"learn/redis/","title":"Redis","keywords":"","body":"1. Redis1. Redis\n"},"learn/linux/":{"url":"learn/linux/","title":"Linux","keywords":"","body":"1. Linux1. Linux\n"},"learn/python/":{"url":"learn/python/","title":"Python","keywords":"","body":"1. Python1. Python\n"},"learn/python/django.html":{"url":"learn/python/django.html","title":"Django","keywords":"","body":"1. Django1. Django\n"}}}